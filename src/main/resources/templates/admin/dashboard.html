<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <th:block th:replace="~{layout/header :: head}"></th:block>

    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 1.5rem;
        }

        .admin-layout {
            display: flex;
            gap: 2rem;
        }

        .admin-sidebar {
            width: 16rem;
            flex-shrink: 0;
        }

        .admin-title {
            font-family: var(--font-serif);
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
        }

        .admin-menu {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            /* 사이드바 고정 */
            position: sticky;
            top: 2rem;
        }

        .admin-menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: #ffffff;
            border: 1px solid #eee1d5;
            border-radius: 0.75rem;
            font-family: var(--font-sans);
            font-weight: 500;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .admin-menu-item:hover {
            background: #fdfaf7; /* var(--bg-cream) 대신 직접 컬러값 사용 */
        }

        .admin-menu-item.active {
            background: #4a3f35; /* var(--text-dark) 대신 직접 컬러값 사용 */
            color: white;
        }

        /* ✅ 핵심: 세로 스크롤 영역 설정 */
        .admin-content {
            flex: 1;
            height: calc(100vh - 200px); /* 화면 높이에 맞춰 고정 */
            overflow-y: auto;            /* 내용 많으면 내부 스크롤 */
            padding-right: 1rem;
        }

        /* 스크롤바 디자인 (직접 컬러 지정) */
        .admin-content::-webkit-scrollbar {
            width: 6px;
        }
        .admin-content::-webkit-scrollbar-thumb {
            background: #d2b48c;
            border-radius: 10px;
        }

        .admin-content::-webkit-scrollbar-track {
            background: #f9f9f9;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* 세로형 아이템 카드 스타일 */
        .report-item, .suspended-item, .word-item, .cat-item {
            padding: 1.5rem;
            background: #fdfaf7;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            transition: 0.3s;
        }
        .report-item:hover, .word-item:hover { border-color: #d2b48c; background: white; }

        .btn-add {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #4a3f35;
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            margin-bottom: 1.5rem;
        }

        .action-buttons { display: flex; gap: 0.5rem; margin-top: 1rem; }

        .icon { width: 1.25rem; height: 1.25rem; stroke: currentColor; fill: none; stroke-width: 2; }

        @media (max-width: 1024px) {
            .admin-layout { flex-direction: column; }
            .admin-sidebar { width: 100%; }
        }
    </style>
</head>

<body class="min-h-screen bg-white">

<div th:replace="~{layout/header :: header}"></div>

<main class="admin-container">
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <h2 class="admin-title">관리자 페이지</h2>
            <nav class="admin-menu">
                <button class="admin-menu-item active" onclick="showSection('reports', event)">
                    <div class="admin-menu-item-content" style="display:flex; align-items:center; gap:0.75rem;">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path></svg>
                        <span>신고 목록</span>
                    </div>
                </button>
                <button class="admin-menu-item" onclick="showSection('suspended', event)">
                    <div class="admin-menu-item-content" style="display:flex; align-items:center; gap:0.75rem;">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path></svg>
                        <span>정지 계정</span>
                    </div>
                </button>
                <button class="admin-menu-item" onclick="showSection('banned', event)">
                    <div class="admin-menu-item-content" style="display:flex; align-items:center; gap:0.75rem;">
                        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle></svg>
                        <span>금지어 목록</span>
                    </div>
                </button>
                <button class="admin-menu-item" onclick="showSection('categories', event)">
                    <div class="admin-menu-item-content" style="display:flex; align-items:center; gap:0.75rem;">
                        <svg class="icon" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"></line></svg>
                        <span>카테고리 목록</span>
                    </div>
                </button>
            </nav>
        </aside>

        <div class="admin-content" id="scrollArea">

            <section id="reports-section" class="content-section active">
                <h3 class="section-title">신고 목록</h3>
                <div th:each="report : ${reportList}" class="report-item">
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <strong th:text="'신고 번호 #' + ${report.reportId}">번호</strong>
                            <p style="font-size: 0.875rem; color: #8a7e72;" th:text="'신고자: ' + ${report.reporterName}">신고자</p>
                        </div>
                        <span style="padding: 0.25rem 0.75rem; background:#fee; color:#c33; border-radius:999px; font-size:0.875rem;" th:text="${report.status}">대기중</span>
                    </div>
                    <p style="margin-top:0.75rem;" th:text="${report.reason}">사유 내용</p>
                    <div class="action-buttons">
                        <button style="padding:0.5rem 1rem; background:#4a3f35; color:white; border:none; border-radius:0.5rem; cursor:pointer;">확인</button>
                        <button style="padding:0.5rem 1rem; background:white; border:1px solid #eee1d5; border-radius:0.5rem; cursor:pointer;">무시</button>
                    </div>
                </div>
            </section>

            <section id="suspended-section" class="content-section">
                <h3 class="section-title">정지 계정 목록</h3>
                <div th:each="user : ${userList}" class="suspended-item">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong th:text="${user.username}">ID</strong>
                            <p style="font-size: 0.875rem; color: #8a7e72;" th:text="'사유: ' + ${user.suspensionReason}">사유</p>
                        </div>
                        <button style="padding:0.5rem 1rem; background:#a68966; color:white; border:none; border-radius:0.5rem; cursor:pointer;">정지 해제</button>
                    </div>
                </div>
            </section>
            <section id="banned-section" class="content-section">
                <h3 class="section-title">금지어 목록</h3>
                <a th:href="@{/admin/register(type='word')}" class="btn-add">+ 금지어 추가</a>

                <div th:each="word : ${wordList}" class="word-item" style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span th:text="${word.forbiddenwordId}" style="color: #ccc; margin-right: 10px;">ID</span>
                        <span th:text="${word.word}">금지어</span>
                    </div>
                    <div style="display:flex; gap:0.5rem;">
                        <a th:href="@{/admin/modify(type='word', id=${word.forbiddenwordId})}" style="text-decoration:none; color:#4a3f35; font-size:0.875rem;">수정</a>

                        <button th:onclick="|if(confirm('삭제하시겠습니까?')) location.href='@{/admin/delete(type='word', id=${word.forbiddenwordId})}'|"
                                style="color:#e74c3c; background:none; border:none; cursor:pointer; font-size:0.875rem;">삭제</button>
                    </div>
                </div>
            </section>

            <section id="categories-section" class="content-section">
                <h3 class="section-title">카테고리 목록</h3>
                <a th:href="@{/admin/register(type='category')}" class="btn-add">+ 카테고리 추가</a>

                <div th:each="cat : ${categoryList}" class="cat-item" style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span th:text="${cat.categoryId}" style="color: #ccc; margin-right: 10px;">ID</span>
                        <span th:text="${cat.categoryName}">카테고리</span>
                    </div>
                    <div style="display:flex; gap:0.5rem;">
                        <a th:href="@{/admin/modify(type='category', id=${cat.categoryId})}" style="text-decoration:none; color:#4a3f35; font-size:0.875rem;">수정</a>
                        <button th:onclick="|if(confirm('삭제하시겠습니까?')) location.href='@{/admin/delete(type='category', id=${cat.categoryId})}'|"
                                style="color:#e74c3c; background:none; border:none; cursor:pointer; font-size:0.875rem;">삭제</button>
                    </div>
                </div>
            </section>
        </div>
    </div> </main>

<script th:inline="javascript">
    function showSection(sectionId, event) {
        // 모든 섹션 숨기기
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        // 선택한 섹션만 보이기
        const target = document.getElementById(sectionId + '-section');
        if(target) target.classList.add('active');

        // 사이드바 모든 버튼 active 해제
        document.querySelectorAll('.admin-menu-item').forEach(item => item.classList.remove('active'));

        if(event) {
            // 클릭한 버튼 active
            event.currentTarget.classList.add('active');
        } else {
            // 파라미터로 왔을 때 해당 버튼 찾아서 active (사이드바 메뉴 유지용)
            const menuBtn = document.querySelector(`button[onclick*='${sectionId}']`);
            if(menuBtn) menuBtn.classList.add('active');
        }
        document.getElementById('scrollArea').scrollTop = 0;
    }

    // ✅ 핵심 수정: 등록/삭제 후 리다이렉트 시 보던 탭 강제 활성화
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const section = urlParams.get('section');

        if (section) {
            // URL에 section 파라미터가 있으면 해당 섹션 함수 실행
            showSection(section);
        }
    }
</script>
</body>
</html>